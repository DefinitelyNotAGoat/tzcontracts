{"struct":[{"name":"Claim","type":[{"name":"resolved","type":["bool"]},{"name":"buyer","type":["string"]},{"name":"seller","type":["string"]}]},{"name":"Asset","type":[{"name":"name","type":["string"]},{"name":"desc","type":["string"]},{"name":"bid","type":["mutez"]},{"name":"manager","type":["address"]},{"name":"winner","type":["address"]},{"name":"claim","type":["Claim"]},{"name":"end","type":["timestamp"]},{"name":"resPeriod","type":["timestamp"]}]}],"storage":[{"name":"auction","type":["map",["int"],["Asset"]]},{"name":"total","type":["int"]}],"entry":[{"name":"addAsset","id":"0xb03afe75","input":[{"name":"asset","type":["Asset"]}],"temp":[{"name":"len","type":["nat"]}],"code":[["if",["or",["lt",["input.asset.end"],["NOW"]],["gt",["input.asset.end"],["input.asset.resPeriod"]]],["throw",["string","Invalid end or resolution dates."]]],["set","len",["length",["storage.auction"]]],["if",["eq",["len"],["nat","0"]],[["ext","push","storage.auction",["int","0"],["input.asset"]],["set","storage.total",["int","1"]]],[["ext","push","storage.auction",["storage.total"],["input.asset"]],["ext","add","storage.total",["int","1"]]]]]},{"name":"addClaimBuyer","id":"0xaf8ead49","input":[{"name":"id","type":["int"]},{"name":"claim","type":["string"]}],"temp":[{"name":"asset","type":["Asset"]}],"code":[["if",["eq",["in",["storage.auction"],["input.id"]],["bool","false"]],["throw",["string","No item exists by that Id for this auction."]]],["set","asset",["ext","get","storage.auction",["input.id"]]],["if",["neq",["SENDER"],["asset.winner"]],["throw",["string","You are not authorized to add to claim."]]],["if",["gt",["asset.end"],["NOW"]],["throw",["string","You can't make a claim on an auction still live."]]],["if",["gt",["asset.resPeriod"],["NOW"]],[["set","asset.claim.resolved",["bool","false"]],["set","asset.claim.buyer",["input.claim"]],["ext","push","storage.auction",["input.id"],["asset"]]]]]},{"name":"addClaimSeller","id":"0x16e502df","input":[{"name":"id","type":["int"]},{"name":"claim","type":["string"]}],"temp":[{"name":"asset","type":["Asset"]}],"code":[["if",["eq",["in",["storage.auction"],["input.id"]],["bool","false"]],["throw",["string","No item exists by that Id for this auction."]]],["set","asset",["ext","get","storage.auction",["input.id"]]],["if",["neq",["SENDER"],["asset.manager"]],["throw",["string","You are not authorized to add to claim."]]],["if",["gt",["asset.end"],["NOW"]],["throw",["string","You can't make a claim on an auction still live."]]],["set","asset.claim.seller",["input.claim"]],["ext","push","storage.auction",["input.id"],["asset"]]]},{"name":"resolveClaim","id":"0x4121a61e","input":[{"name":"id","type":["int"]}],"temp":[{"name":"asset","type":["Asset"]}],"code":[["if",["eq",["in",["storage.auction"],["input.id"]],["bool","false"]],["throw",["string","No item exists by that Id for this auction."]]],["set","asset",["ext","get","storage.auction",["input.id"]]],["if",["neq",["SENDER"],["asset.winner"]],["throw",["string","You are not authorized to resolve this claim."]]],["if",["gt",["asset.end"],["NOW"]],["throw",["string","You can't resolve a claim on an auction still live."]]],["if",["eq",["asset.claim.resolved"],["bool","true"]],["throw",["string","There is nothing to resolve."]]],["set","asset.claim.resolved",["bool","true"]],["ext","push","storage.auction",["input.id"],["asset"]]]},{"name":"withdraw","id":"0x200e7681","input":[{"name":"id","type":["int"]}],"temp":[{"name":"asset","type":["Asset"]}],"code":[["if",["eq",["in",["storage.auction"],["input.id"]],["bool","false"]],["throw",["string","No item exists by that Id for this auction."]]],["set","asset",["ext","get","storage.auction",["input.id"]]],["if",["neq",["SENDER"],["asset.manager"]],["throw",["string","You are not authorized to withdraw from this auction."]]],["if",["eq",["asset.claim.resolved"],["bool","false"]],["throw",["string","You must resolve the claim with the buyer to receive funds."]]],["if",["or",["gt",["asset.end"],["NOW"]],["lt",["NOW"],["asset.resPeriod"]]],["throw",["string","The auction has not ended or the resolution period has not past."]]],["if",["neq",["asset.bid"],["mutez","0"]],["transfer",["SENDER"],["asset.bid"]],["throw",["string","You cannot withdraw 0."]]]]},{"name":"refund","id":"0x75ed3e40","input":[{"name":"id","type":["int"]}],"temp":[{"name":"asset","type":["Asset"]}],"code":[["if",["eq",["in",["storage.auction"],["input.id"]],["bool","false"]],["throw",["string","No item exists by that Id for this auction."]]],["set","asset",["ext","get","storage.auction",["input.id"]]],["if",["neq",["SENDER"],["asset.manager"]],["throw",["string","You are not authorized to send a refund for this auction."]]],["if",["gt",["asset.end"],["NOW"]],["throw",["string","The auction has not ended."]]],["if",["neq",["asset.bid"],["mutez","0"]],["transfer",["asset.winner"],["asset.bid"]],["throw",["string","You cannot refund 0."]]],["set","asset.claim.resolved",["bool","true"]],["ext","push","storage.auction",["input.id"],["asset"]]]},{"name":"bid","id":"0x65e3abe5","input":[{"name":"id","type":["int"]}],"temp":[{"name":"asset","type":["Asset"]},{"name":"oldWinner","type":["address"]}],"code":[["if",["eq",["in",["storage.auction"],["input.id"]],["bool","false"]],["throw",["string","No item exists by that Id for this auction."]]],["set","asset",["ext","get","storage.auction",["input.id"]]],["set","oldWinner",["asset.winner"]],["if",["eq",["SENDER"],["asset.manager"]],["throw",["string","You cant bid against your own item."]]],["if",["lt",["asset.end"],["NOW"]],["throw",["string","The auction for the item requested has already ended."]]],["if",["eq",["AMOUNT"],["mutez","0"]],["throw",["string","You cannot bid 0."]]],["if",["ge",["asset.bid"],["AMOUNT"]],[["transfer",["SENDER"],["AMOUNT"]],["throw",["string","Sending funds back - bid too low."]]],[["if",["neq",["asset.bid"],["mutez","0"]],["transfer",["oldWinner"],["AMOUNT"]]],["set","asset.winner",["SENDER"]],["set","asset.bid",["AMOUNT"]],["ext","push","storage.auction",["input.id"],["asset"]]]]]}]}